// simple drags within parent v0.3
(function(win,doc,$,undefined){$.fn.drags=function(opts){var options=$.extend({},opts);return this.each(function(){var $this=$(this),isDragging=false,eventBefore,self,parent;$this.on("mousedown",function(event){isDragging=true;$this.parent().addClass('dragging');eventBefore=event;self={height:$this.height(),width:$this.width(),position:$this.position()};parent={height:$this.parent().height(),width:$this.parent().width()};event.preventDefault();doc.onselectstart=function(){return false;};});$(doc).on("mouseup",function(){if(!isDragging)return;isDragging=false;$this.parent().removeClass('dragging');doc.onselectstart=null;}).on("mousemove",function(event){if(!isDragging)return;var scale={},bubbleScale={};if(options.axis!=='x'){var delta=event.pageY-eventBefore.pageY;var goal=self.position.top+delta;var top=Math.max(goal,0)&&Math.min(goal,parent.height-self.height);scale.y=top/parent.height;bubbleScale.y=(goal>parent.height)?1:scale.y;}
if(options.axis!=='y'){var delta=event.pageX-eventBefore.pageX;var goal=self.position.left+delta;var left=Math.max(goal,0)&&Math.min(goal,parent.width-self.width);scale.x=left/parent.width;bubbleScale.x=(goal>parent.width)?1:scale.x;}
$this.css({top:(scale.y===undefined)?undefined:scale.y*100+'%',left:(scale.x===undefined)?undefined:scale.x*100+'%'});if($.isFunction(options.during)){options.during(bubbleScale);}});});};})(window,document,jQuery);

// jquery.mousewheel-2.0.0.js
(function($,undefined){var types=['DOMMouseScroll','mousewheel','MozMousePixelScroll'];if($.event.fixHooks){for(var i=types.length;i;){$.event.fixHooks[types[--i]]=$.event.mouseHooks;}}
$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=types.length;i;){this.addEventListener(types[--i],handler,false);}}else{this.onmousewheel=handler;}},teardown:function(){if(this.removeEventListener){for(var i=types.length;i;){this.removeEventListener(types[--i],handler,false);}}else{this.onmousewheel=null;}}};function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(orgEvent.wheelDelta){delta=orgEvent.wheelDelta/120;}
if(orgEvent.detail){if(orgEvent.type==types[2]){this.removeEventListener(types[0],handler,false);delta=-orgEvent.detail/42;}else{delta=-orgEvent.detail/3;}}
deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta;}
if(orgEvent.wheelDeltaY!==undefined){deltaY=orgEvent.wheelDeltaY/120;}
if(orgEvent.wheelDeltaX!==undefined){deltaX=-1*orgEvent.wheelDeltaX/120;}
args.unshift(event,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args);}})(jQuery);

// pagination slider v0.3
(function(win,doc,$,undefined){var NAMESPACE='pSlider',EVENT_RATE=200;var _template=['<div class="range">','<div class="bg">','<div class="head"></div>','<div class="tail"></div>','</div>','<div class="current">','<div class="head">','<div class="tip"></div>','</div>','<div class="tail">','<div class="tip"></div>','</div>','</div>','</div>'].join('');var methods={init:function(opts){var options=$.extend({start:0,limit:10,total:0},opts);return this.each(function(){var $this=$(this),$data=$this.data(NAMESPACE);if(!$data){$this.data(NAMESPACE,{});$this.children().length||$this.html(_template);_bindEvents.call($this);}
_attr.call($this,{start:options.start,limit:options.limit,total:options.total,silent:true});});},destroy:function(){return this.each(function(){var $this=$(this);$this.parent().off('mousewheel');$this.removeData(NAMESPACE);$this.empty();});},attr:function(key,value){return _attr.apply($(this),arguments);},move:function(step){return this.each(function(){_move.call($(this),step);});}};$.fn[NAMESPACE]=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.'+NAMESPACE);}};var _bindEvents=function(){var that=this,$range=that.find('.range'),$current=that.find('.current'),$data=that.data(NAMESPACE),$parent=that.parent();$range.on('click',function(event){_move.call(that,((event.pageY>$current.offset().top)?1:-1)*$data.limit);}).on('click','.current',function(event){event.stopPropagation();});$current.drags({axis:'y',during:(function(){var internal=_.throttle(function(scale){var start=Math.min(Math.round(scale.y*$data.total),$data.total-$data.limit);_tip.call(that,start);that.data(NAMESPACE).start=start;that.trigger('change:start',start);},EVENT_RATE);return function(scale){internal(scale);};})()});$parent.on('mousewheel',function(event,delta){if(delta>0){_move.call(that,-1);}else if(delta<0){_move.call(that,1);}
event.preventDefault();});var ie6=!-[1,]&&!window.XMLHttpRequest;if(ie6){_.each([that,$parent],function($dom){$dom.hover(function(event){$(this).addClass('ie6-hover');},function(event){$(this).removeClass('ie6-hover');});});}};var _attr=function(key,value){var $current=this.find('.current'),$data=this.data(NAMESPACE);if(arguments.length===1&&typeof key==='string'){return $data[key];}
var attrs={};if(arguments.length===2){attrs[key]=value;}else if(arguments.length===1&&typeof key==='object'){attrs=key;}
if(attrs.total!=null){$data.total=Math.max(attrs.total,0.0000001);$current.css('display',($data.total<1)?'none':'block');if(attrs.limit==null){attrs.limit=$data.limit;}}
if(attrs.limit!=null){$data.limit=Math.max(attrs.limit,0);if(attrs.start==null){attrs.start=$data.start;}
$current.css('height',Math.min($data.limit/$data.total,1)*100+'%');}
if(attrs.start!=null){$data.start=Math.max(attrs.start,0);$data.start=Math.min($data.start,$data.total-1);$current.css('top',Math.min($data.start,Math.max($data.total-$data.limit,0))/$data.total*100+'%');_tip.call(this,$data.start);attrs.silent||this.trigger('change:start',$data.start);}};var _move=function(step){var before,goal;before=_attr.call(this,'start');goal=step+before;_attr.call(this,'start',goal);};var _tip=function(count){var $head=this.find('.current .head .tip'),$tail=this.find('.current .tail .tip'),$data=this.data(NAMESPACE);$head.html(count);$tail.html(Math.min(count+$data.limit,Math.round($data.total)));};})(window,document,jQuery);

// pagination jumper v0.3
(function(win,doc,$,undefined){var NAMESPACE='pJumper';var _template=['<span class="tip text">','共<span class="count">0</span>条, <span class="pageCount">0</span>页','</span>','<button class="next text">下一页</button>','<span class="current text">','第<input class="write text"><span class="read">0</span>页','</span>','<button class="prev text">上一页</button>'].join('');var methods={init:function(opts){var options=$.extend({current:0,count:0},opts);return this.each(function(){var $this=$(this),$data=$this.data(NAMESPACE);if(!$data){$this.data(NAMESPACE,{});$this.children().length||$this.html(_template);_bindEvents.call($this);}
_attr.call($this,{current:options.current,count:options.count,pageSize:options.pageSize,silent:true});});},destroy:function(){return this.each(function(){var $this=$(this);$this.removeData(NAMESPACE);$this.empty();});},attr:function(key,value){return _attr.apply($(this),arguments);}};$.fn[NAMESPACE]=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.'+NAMESPACE);}};var _bindEvents=function(){var that=this,$data=that.data(NAMESPACE),$prev=that.find('.prev'),$next=that.find('.next'),$tip=that.find('.tip'),$current=that.find('.current'),$currentRead=$current.find('.read'),$currentWrite=$current.find('.write');$prev.on('click',function(event){_attr.call(that,'current',$data.current-$data.pageSize);});$next.on('click',function(event){_attr.call(that,'current',$data.current+$data.pageSize);});$currentRead.on('click',function(event){$currentRead.css('display','none');$currentWrite.css('display','inline').focus();});$currentWrite.on('blur',function(event){$currentRead.css('display','inline');$currentWrite.css('display','none');_attr.call(that,'current',($currentWrite.val()-1)*$data.pageSize);});$currentWrite.on('keyup',function(event){if(event.keyCode===13){_attr.call(that,'current',($currentWrite.val()-1)*$data.pageSize);}
if(!/^\d+$/.test($currentWrite.val())){$currentWrite.val(/^\d+/.exec($currentWrite.val()));}
return false;});};var _attr=function(key,value){var $data=this.data(NAMESPACE);if(arguments.length===1&&typeof key==='string'){return $data[key];}
var attrs={};if(arguments.length===2){attrs[key]=value;}else if(arguments.length===1&&typeof key==='object'){attrs=key;}
if(attrs.count!=null){$data.count=Math.max(attrs.count,0);if($data.count){this.css('display','block');this.find('.count').html($data.count);}else{this.css('display','none');}}
if(attrs.pageSize!=null){$data.pageSize=Math.max(attrs.pageSize,0);this.find('.pageCount').html($data.count?(Math.floor(($data.count-1)/$data.pageSize)+1):0);}
if(attrs.current!=null){$data.current=Math.max(attrs.current,0)&&Math.min(attrs.current,$data.count-1);var totalPage=$data.count?(Math.floor(($data.count-1)/$data.pageSize)+1):0;var currentPage=totalPage?(Math.floor($data.current/$data.pageSize)+1):0;this.find('.prev').css('display',(currentPage>1)?'inline':'none');this.find('.next').css('display',(currentPage<totalPage)?'inline':'none');this.find('.current .read').html(currentPage);this.find('.current .write').val(currentPage);attrs.silent||this.trigger('change:current',$data.current);}};})(window,document,jQuery);

// pagination screen v0.3
(function(win,doc,$,undefined){var NAME_SPACE='pScreen',PAGE_ID_PREFIX='page-',BUFFER_PAGE_COUNT=2,DEBOUNCE_RATE=500;var methods={init:function(opts){var options=$.extend({pageSize:10,buffered:true},opts);return this.each(function(){var $this=$(this),$data=$this.data(NAME_SPACE);if(!$data){$data={};$this.data(NAME_SPACE,$data);$this.children().length||$this.html('<div class="overlay"></div>');_bindEvents.call($this);}
$.extend($data,{buffered:options.buffered,pageSize:options.pageSize,onData:options.onData,dataSource:_dataSourceTransformer(options.dataSource),params:options.params});_reload.call($this);});},destroy:function(){return this.each(function(){var $this=$(this);$this.parent().off('click','.item');$this.removeData(NAME_SPACE);$this.empty();});},onData:function(callback){if(callback){return this.each(function(){$(this).data(NAME_SPACE).onData=callback;});}else{return this.data(NAME_SPACE).onData;}},dataSource:function(dataSource){if(dataSource){dataSource=_dataSourceTransformer(dataSource);return this.each(function(){var $this=$(this);$this.data(NAME_SPACE).dataSource=dataSource;_reload.call($this);});}else{return this.data(NAME_SPACE).dataSource;}},params:function(params){if(params){return this.each(function(){var $this=$(this);$this.data(NAME_SPACE).params=params;_reload.call($this);});}else{return this.data(NAME_SPACE).params;}},select:function(selections){if(selections!=null){return this.each(function(){var $this=$(this),$data=$this.data(NAME_SPACE);$this.find('.item').removeClass('selected');_.isArray(selections)||(selections=[selections]);var selector=_.reduce(_.map(selections,function(selection){return'.item:eq('+selection+')';}),function(memo,value){return memo+','+value;});$this.find(selector).addClass('selected');});}else{var list=[];var $doms=this.find('.selected');$doms.each(function(){list.push($(this).data('data'));});return list;}},locate:function(location){if(location!=null){return this.each(function(){var $this=$(this);_locate.call($this,location);});}else{return this.find('.pointed').data('data');}},nextPage:function(){return this.each(function(){var $this=$(this),$data=$this.data(NAME_SPACE),pageMapping=$data.pageMapping,$currentPage=pageMapping.currentPage;if(!$currentPage){_reload.call($this);}else{var location=(_pageNumber($currentPage)+1)*$data.pageSize;_locate.call($this,location);}});},prevPage:function(){return this.each(function(){var $this=$(this),$data=$this.data(NAME_SPACE),pageMapping=$data.pageMapping,$currentPage=pageMapping.currentPage;if(!$currentPage){_reload.call($this);}else{var location=(_pageNumber($currentPage)-1)*$data.pageSize;_locate.call($this,location);}});}};$.fn[NAME_SPACE]=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.'+NAME_SPACE);}};var _bindEvents=function(){this.parent().on('click','.item',function(event){$(this).toggleClass('selected');});};var _reload=function(){var that=this,$data=that.data(NAME_SPACE),pageMapping=$data.pageMapping={};that.find('.page').remove();$data.count=null;$data.buffer={};var $page=_createPage.call(that,0);$page.addClass('current');pageMapping.currentPage=$page;_completePage.call(that,$page,function(){_locate.call(that,0);});};var _locate=(function(){var _getContext=function(location){var $data=this.data(NAME_SPACE),pageMapping=$data.pageMapping,$currentPage=pageMapping.currentPage;return(!$currentPage)?null:{that:this,location:location,pageMapping:pageMapping,buffered:$data.buffered,pageSize:$data.pageSize,count:$data.count,targetPageNumber:Math.floor(location/$data.pageSize),currentPageNumber:_pageNumber($currentPage)};};var _debounceCreatePage=_.debounce(function(pageNumber,callback){callback(_createPage.call(this,pageNumber));},DEBOUNCE_RATE);var _fixCurrentPage=function(context){context.buffered?context.pageMapping.currentPage.removeClass('current'):(delete context.pageMapping[context.currentPageNumber],context.pageMapping.currentPage.remove());context.pageMapping.currentPage=context.pageMapping[context.targetPageNumber].addClass('current');};var _pointItem=function(context){context.pageMapping.currentPage.find('.item').eq(context.location%context.pageSize).addClass('pointed');};var _findPage=function(context){if(context.buffered){context.pageMapping.lastPageNumber=context.currentPageNumber;}
var $targetPage=context.pageMapping[context.targetPageNumber];if($targetPage){_fixCurrentPage(context);_pointItem(context);}else{_debounceCreatePage.call(context.that,context.targetPageNumber,function($page){_completePage.call(context.that,$page,function($page){_fixCurrentPage(context);_pointItem(context);});});}};return function(location){var context=_getContext.call(this,location);if(!context)return _reload.call(this);if(!_.isFinite(context.targetPageNumber)||location<0||location>context.count)return;context.pageMapping.currentPage.find('.pointed').removeClass('pointed');context.targetPageNumber===context.currentPageNumber?_pointItem(context):_findPage(context);};})();var _createPage=function(pageNumber){var $page=$('<div class="page"></div>');$page.attr('id',PAGE_ID_PREFIX+pageNumber);this.append($page);this.data(NAME_SPACE).pageMapping[pageNumber]=$page;return $page;};var _completePage=function($page,callback){var that=this,$data=that.data(NAME_SPACE);var params=_.extend({skip:_pageNumber($page)*$data.pageSize,limit:$data.pageSize,count:($data.count==null)},$data.params);var success=function(data){var $doms=_.map(data.list,function(item){var $dom=$($data.onData(item));$dom.addClass('item');$dom.data('data',item);return $dom;});_setOverlay.call(that,'empty',_.isEmpty($doms)?'add':'remove');_append.call(that,$page,$doms);_setOverlay.call(that,'loading','remove');if(data.count!=null){$data.count=data.count;that.trigger('reload',{pageSize:$data.pageSize,count:$data.count});}
_.isFunction(callback)&&callback($page);};var error=function(){that.find('.page').remove();_setOverlay.call(that,'error');};_setOverlay.call(that,'loading');_fetchData.call(that,params,success,error);};var _setOverlay=function(className,operation){var $overlay=this.find('.overlay');if(operation==='remove'){$overlay.removeClass(className);}else{$overlay.addClass(className);var parentHeight=this.parent().css('height');$overlay.css('height',(parentHeight==='0px')?'300px':parentHeight);}};var _fetchData=(function(){var _doFetch=function(dataSource,params,success,error){dataSource({params:params,success:success,error:error});};var _prepareBuffer=function(params){var $data=this.data(NAME_SPACE),pageSize=$data.pageSize,pageMapping=$data.pageMapping,buffer=$data.buffer;maxPageNumber=Math.floor($data.count-1/pageSize),currentPageNumber=Math.floor(params.skip/pageSize),lastPageNumber=pageMapping.lastPageNumber;if(params.skip===0)return;var direction=currentPageNumber-lastPageNumber;if(direction===1||direction===-1){for(var i=0;i<BUFFER_PAGE_COUNT;i++){(function(bufferPageNumber){if(bufferPageNumber>=0&&bufferPageNumber<=maxPageNumber&&!buffer[bufferPageNumber]&&!pageMapping[bufferPageNumber]){var tempParams=_.clone(params);tempParams.skip=pageSize*bufferPageNumber;_doFetch($data.dataSource,tempParams,function(data){buffer[bufferPageNumber]=data;});}})(currentPageNumber+(i+1)*direction);}}};return function(params,success,error){var that=this,$data=that.data(NAME_SPACE);if($data.buffered){var buffer=$data.buffer,currentPageNumber=Math.floor(params.skip/$data.pageSize);if(buffer&&buffer[currentPageNumber]){success(buffer[currentPageNumber]);delete buffer[currentPageNumber];_prepareBuffer.call(that,params);}else{_doFetch($data.dataSource,params,function(data){success(data);_prepareBuffer.call(that,params);},error);}}else{_doFetch($data.dataSource,params,success,error);}};})();var _append=function($page,$doms){var $data=this.data(NAME_SPACE),pageSize=$data.pageSize;for(var i=0,length=Math.min(pageSize,$doms.length);i<length;i++){$page.append($doms.shift());}
if($doms.length>=pageSize){var nextPageNumber=_pageNumber($page)+1;if(!$data.pageMapping[nextPageNumber]){arguments.callee.call(this,_createPage.call(this,nextPageNumber),$doms);}}};var _dataSourceTransformer=function(dataSource){return dataSource&&_.isFunction(dataSource)?dataSource:function(args){$.ajax({url:dataSource,data:_.extend({},args.params),success:args.success,error:args.error,dataType:'json',cache:false});};};var _pageNumber=function($page){return parseInt($page.attr('id').substring(PAGE_ID_PREFIX.length));};})(window,document,jQuery);

// pagination v0.3
(function(win,doc,$,undefined){var methods={init:function(opts){var options=$.extend({mode:'slider'},opts);return this.each(function(){var $this=$(this);if(!$this.hasClass('pagination')){$this.addClass('pagination');if(!$this.children().length){var template='<div class="screen"></div>';(options.mode==='slider')&&(template+='<div class="slider"></div>');(options.mode==='jumper')&&(template+='<div class="jumper"></div>');$this.html(template);}
_bindEvents.call($this);}
(options.mode==='slider')&&$this.find('.slider').pSlider(options);(options.mode==='jumper')&&$this.find('.jumper').pJumper(options);$this.find('.screen').pScreen(options);});},destroy:function(){return this.each(function(){var $this=$(this),$screen=$this.find('.screen'),$slider=$this.find('.slider'),$jumper=$this.find('.jumper');$this.removeClass('pagination');$screen.pScreen('destroy');$slider.length&&$this.find('.slider').pSlider('destroy');$jumper.length&&$this.find('.jumper').pJumper('destroy');$this.empty();});},onData:function(callback){var $screen=$(this).find('.screen');return $screen.pScreen('onData',callback);},dataSource:function(dataSource){var $screen=$(this).find('.screen');return $screen.pScreen('dataSource',dataSource);},sort:function(sort){var $screen=$(this).find('.screen'),params=$screen.pScreen('params')||{};if(sort){params.orderBy=_.isString(sort)?sort:_sortTransformer(sort);$screen.pScreen('params',params);}else{return _sortTransformer(params.sort);}},query:function(query){var $screen=$(this).find('.screen'),params=$screen.pScreen('params')||{};if(query){params.orderBy=_.isString(query)?query:_queryTransformer(query);$screen.pScreen('params',params);}else{return _queryTransformer(params.query);}},select:function(selections){var $screen=$(this).find('.screen');return $screen.pScreen('select',selections);}};$.fn.pagination=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.pagination');}};var _bindEvents=function(){var that=this,$screen=that.find('.screen'),$slider=that.find('.slider'),$jumper=that.find('.jumper');$screen.on('reload',function(event,args){$slider.length&&$slider.pSlider('attr',{start:0,limit:args.pageSize,total:args.count,silent:true});$jumper.length&&$jumper.pJumper('attr',{current:0,pageSize:args.pageSize,count:args.count,silent:true});event.stopPropagation();});$slider.length&&$slider.on('change:start',function(event,start){$screen.pScreen('locate',start);event.stopPropagation();});$jumper.length&&$jumper.on('change:current',function(event,current){$screen.pScreen('locate',current);event.stopPropagation();});};var _sortTransformer=function(sort){if(_.isArray(sort)){return _.reduce(_.map(sort,function(current){return current.key+' '+current.order;}),function(memo,value){return memo+','+value;});}
if(_.isString(sort)){return _.map(sort.split(','),function(current){current=$.trim(current).split(' ');return{key:$.trim(current[0]),order:$.trim(current[1])};});}
return[];};var _queryTransformer=function(query){if(_.isArray(query)){return _.reduce(_.map(query,function(current){return current.key+' '+current.operator+' '+current.value;}),function(memo,value){return memo+','+value;});}
if(_.isString(query)){return _.map(query.split(','),function(current){current=$.trim(current).split(' ');return{key:$.trim(current[0]),operator:$.trim(current[1]),value:$.trim(current[2])};});}
return[];};})(window,document,jQuery);